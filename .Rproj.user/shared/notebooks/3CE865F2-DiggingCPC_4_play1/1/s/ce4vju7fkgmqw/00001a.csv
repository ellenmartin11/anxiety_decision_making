"0",""
"0","# residuals"
"0",""
"0","# Now for residuals with Trial filter"
"0","choice_risky_pos_res <- happyData1 %>%"
"0","  filter(Choice == 2 & NextIsland == 2 & LastIsland == 2 & (Trial == ""Gain"" | Trial == ""Loss"")) %>%"
"0","  group_by(userKey, Trial) %>%"
"0","  summarise(mean_residuals = mean(residuals, na.rm = TRUE),"
"0","              .groups = 'drop') %>%"
"0","  mutate(Choice = ""Risky"","
"0","         Future = ""Positive"")"
"0",""
"0","choice_risky_neg_res <- happyData1 %>%"
"0","  filter(Choice == 2 & NextIsland == 1 & LastIsland == 1 & (Trial == ""Gain"" | Trial == ""Loss"")) %>%"
"0","  group_by(userKey, Trial) %>%"
"0","  summarise(mean_residuals = mean(residuals, na.rm = TRUE),"
"0","              .groups = 'drop') %>%"
"0","  mutate(Choice = ""Risky"","
"0","         Future = ""Negative"")"
"0",""
"0",""
"0","# Safe choice residuals"
"0","choice_safe_pos_res <- happyData1 %>%"
"0","  filter(Choice == 1 & NextIsland == 2 & LastIsland == 2 & (Trial == ""Gain"" | Trial == ""Loss"")) %>%"
"0","  group_by(userKey, Trial) %>%"
"0","  summarise(mean_residuals = mean(residuals, na.rm = TRUE),"
"0","              .groups = 'drop') %>%"
"0","  mutate(Choice = ""Safe"","
"0","         Future = ""Positive"")"
"0",""
"0","choice_safe_neg_res <- happyData1 %>%"
"0","  filter(Choice == 1 & NextIsland == 1 & LastIsland == 1 & (Trial == ""Gain"" | Trial == ""Loss"")) %>%"
"0","  group_by(userKey, Trial) %>%"
"0","  summarise(mean_residuals = mean(residuals, na.rm = TRUE),"
"0","              .groups = 'drop') %>%"
"0","  mutate(Choice = ""Safe"","
"0","         Future = ""Negative"")"
"0",""
"0","# Combine all choices residuals"
"0","choice_combined_res <- bind_rows(choice_risky_pos_res, choice_risky_neg_res, choice_safe_pos_res, choice_safe_neg_res)"
"0",""
"0","# Summarise by Choice, Future, and Trial for residuals"
"0","summary_choice_residuals <- choice_combined_res %>%"
"0","  group_by(Choice, Future, Trial) %>%"
"0","  summarise(mean_resids = mean(mean_residuals, na.rm = TRUE),"
"0","            sem_resids = sd(mean_residuals, na.rm = TRUE) / sqrt(n()))"
"1","[38;5;254m`summarise()` has grouped output by 'Choice', 'Future'. You can override using the `.groups` argument.[39m
"
"0","# Plot residuals based on choice, future, and trial"
"0","ggplot(summary_choice_residuals, aes(x = Choice, y = mean_resids, fill=Trial)) +"
"0","geom_bar(stat = ""identity"", position = ""dodge"", width = 0.7, color = ""black"") +"
"0","  geom_errorbar(aes(ymin = mean_resids - sem_resids, ymax = mean_resids + sem_resids),"
"0","                position = position_dodge(0.7), width = 0.2) +"
"0","  geom_hline(yintercept = 0, linetype = ""dotted"", color = ""black"") +  # Add a dotted line at y=0"
"0","  labs("
"0","    title = ""Happiness Residuals (z-scored) Based on Choice and Trial"","
"0","    x = ""Choice"","
"0","    y = ""zHappy Residuals"""
"0","  ) +"
"0","  facet_wrap(~Future) +"
"0","  theme_minimal() +"
"0","    scale_fill_manual(values = c(""Gain"" = ""#FFD700"", ""Loss"" = ""#FF6347"")) + "
"0","  ylim(-0.3, 0.3) + "
"0","  poster_theme"
